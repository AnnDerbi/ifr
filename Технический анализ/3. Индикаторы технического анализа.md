# Понятие индикатора

**Индикаторы** - алгоритмы, которые позволяют прогнозировать данные о будущих ценах, используя данные о торгах в прошлом.
- Трендовые индикаторы - для торговле при устойчивом изменении цены, когда есть тренды (скользящее среднее, MACD)
- Осцилляторы - когда не имеется явно выраженного движения

# Скользящее среднее

**Скользящее среднее** - среднее значение цен, зафиксированное на N дней подряд.

**При расчёте скользящего среднего могут использоваться следующие типы цен:**
1. Цена закрытия: $Close$
2. Среднее между максимальной и минимальной ценой: $(High + Low) / 2$
3. Среднее между ценами открытия и закрытия: $(Open + Close) / 2$
4. Среднее между ценами открытия, закрытия, максимальной и минимальной: $(Open + Close + High + Low) / 4$
5. Среднее между максимальной и минимальной ценами и удвоенной ценой закрытия: $(High + Low + 2*Close) / 4$

**Виды скользящих средних:**
1. Простое (simple moving average, SMA) - среднее арифметическое цен за период
2. Взвешенное (weighted moving average, WMA) - учёт того, что недавние цены имеют большее значение, чем более старые
3. Экспоненциальное (exponential movin average, EMA) - похоже на WMA, но значение недавних данных растет по экспоненте
4. Сглаженное (smoothed moving average, SMMA) - дополнительное сглаживание кривой
5. Объемно-взвешенное (volume weighted moving average) - помимо цен также учитывается объем торгов
$$SMA = \frac{Сумма\ цен\ за\ период\ скользящего\ среднего}{Период\ скользящего\ среднего}$$
$$WMA = \frac{Сумма\ произведений\ цен\ и\ веса\ цены}{Сумма\ весов\ цен}$$
$$EMA (k, n) = EMA(k-1,n) + \frac{2}{n+1} \cdot (P - EMA(k-1, n))$$
$EMA(k,n)$ - экспоненциальное скользящее среднее с периодом $n$ на момент $k$
$P$ - текущая цена

Чем больше период скользящего среднего, тем больше он удаляется от графика

## Применение скользящего среднего

- Более короткий период - больше сигналов, но ниже надежность каждого отдельного сигнала
- Более длинный период - выше надежность каждого отдельного сигнала, но сигналы запаздывают

При отсутствии трендов может давать достаточно много ложных сигналов
### Пересечение скользящего среднего
**Сигнал к покупке (продаже):**
1. Цена пересекает MA снизу вверх (сверху вниз)
**Плюсы:**
- Рано входим в позицию
**Недостатки:**
- Достаточно много ложных сигналов
### Метод двойного пересечения
Более короткое MA строят зеленым, более длинное - красным
**Сигнал к покупке (продаже)** при последовательном выполнении условий:
1. Цена пересекает короткое MA снизу вверх (сверху вниз)
2. Цена пересекает длинное MA снизу вверх (сверху вниз)
3. Короткое MA пересекает длинное MA снизу вверх (сверху вниз)
### Метод тройного пересечения
**Сигнал к покупке (продаже)** при последовательном выполнении условий:
1. Короткое MA пересекает среднее MA снизу вверх (сверху вниз)
2. Короткое MA пересекает длинное MA снизу вверх (сверху вниз)
3. Среднее MA пересекает длинное MA снизу вверх (сверху вниз)

# MACD

**MACD (Moving Average Convergence/Divergence)** - схождение расхождение скользящих средних, т.е. разность между двумя экспоненциальными скользящими средними (по умолчанию с периодами 12 и 26).

- Строится под графиком в виде синей линии
- Сигнальная линия (оранжевая линия) - скользящее среднее от MACD (по умолчанию с периодом 9).
- Гистограмма MACD - расстояние между MACD и его сигнальной линией
	- Когда MACD ниже - столбики красные, иначе - зеленые
	- Если гистограмма увеличивается (вверх или вниз), то столбик ярче, иначе - тусклее

**Базовая стратегия:**
- Покупаем, когда MACD пересекает свою сигнальную линия снизу вверх
- Продаём, когда MACD пересекает свою сигнальную линию сверху вниз

**Альтернативная стратегия** (заранее предугадываем направление тренда):
- Покупаем, когда разность между MACD и сигнальной линией минимальна (когда столбик переходит из ярко красного в тускло красный)
- Продаём, когда разность между MACD и сигнальной линией максимальна (когда столбик переходит из ярко зеленого в тускло зеленый)
# Parabolic SAR

**Parabolic SAR** (Parabolic Time Price System) - параболическая система времени/цены
Предназначен для определения основного тренда и момента входа/выхода на рынок /с рынка.

**Для длинных позиций:**
$SAR_i = A \cdot (HIGH_{i-1}-SAR_{i-1})+SAR_{i-1}$

**Для коротких позиций:**
$SAR_i = A \cdot (LOW_{i-1}-SAR_{i-1})+SAR_{i-1}$

$SAR_{i-1}$ - значение в предыдущий период
$HIGH_{i-1}, LOW_{i-1}$ - максимальное, минимальное значение цены в предыдущий период
$A$ - коэффициент ускорения:
- В первый день, когда параболик становится сверху или снизу графика, он становится 0,02
- Значение увеличивается на 0,02, каждый раз, когда цена достигает нового максимума или минимума

**Свойства и сигналы:**
- Параболик является линией поддержки при восходящем тренде (если идёт снизу графика) и линией сопротивления при нисходящем тренде (если идёт сверху графика)
- Если параболик находился выше графика цена, а стал находится ниже - **сигнал к покупке**
- Если параболик находился ниже графика цена, а стал находится выше - **сигнал к продаже**
- Расстояние между точками параболика является индикатором силы тренда

# Канальные индикаторы

**Сигналы для всех каналов:**
- Если цена выходит из канала вверх, то открываем заявку на продажу
- Если цена выходит из канала вниз, то открываем заявку на покупку
- Четких рекомендаций по закрытию нет, но один из стандартных - закрытие при достижении скользящей средней, также возможно достижение противоположного края или стоп-лосс/тейк-профит

## Конверты скользящих средних

MA Enevelopes
- Средняя линия - скользящее среднее
- Верхняя и нижняя линии отстоят от средней линии на заданное число процентов

## Канал Кельтнера

- Средняя линия - скользящее среднее от типичной цены
- Типичная цена - среднее между максимальной, минимальной ценами и ценой закрытия
- Верхняя и нижняя линии отстоят от средней линии на скользящее среднее от дневного торгового диапазона
- Дневной торговый диапазон - разность между максимумом и минимумом за выбранный период

Учитывает волатильность - если она больше, то канал становится шире, а в период застоя канал сужается

## Канал Кельтнера (модифицированный)

- Средняя линия - экспоненциальное скользящее среднее от типичной цены
- Верхняя и нижняя линии отстоят от средней линии на величину среднего истинного интервала (ATR, average true range)
- $TR_i = max(HIGH_i, CLOSE_{i-1})-min(LOW_i, CLOSE_{i-1})$

## Полосы Боллинджера

- Полосы Боллинджера (Bollinger bands) - развитие идеи конвертов и канала Кельтнера
- Средняя линия - экспоненциальное скользящее среднее
- Верхняя и нижняя линии отстоят от средней линии на величину, пропорциональную волатильности рынка за заданный период

При увеличении множителя перед значением стандартного отклонения канал расширится, а количество сигналов может упасть, а может остаться неизменным.

# ADX

**TradingView:**
- В поиске: *индекс направленного движения (DMI)*
- На графике: *DMI*

ADX (Average Directional Movement Index) - индикатор среднего направленного движения.
ADX срабатывает медленно из-за двойного сглаживания, а также ненадежен при высокой волатильности и резком переломе тренда.

Не даёт сигналов на покупку или продажу, но указывает на силу имеющегося тренда:
- <20 - нет тренда, либо текущий тренд слаб
- 21-40 - трендовый рынок
- 41-50 и выше - очень сильный тренд (возможно, тренд находится на максимуме и скоро разворот)

**Построение:**
1. Определение индикатора **DI (Directional Index)**:
	1. Рассчитываем:
		- Current High - Previous High = UpMove
		- Previous Low - Current Low = DownMove
	2. Определяем:
		- Если $UpMove > DownMove$ и $UpMove > 0$, то $+DM = UpMove$, иначе $+DM = 0$
		- Если $DownMove > Upmove$ и $Downmove > 0$, then $-DM = DownMove$, иначе $-DM = 0$
2. Определяем **ATR (Average True Range)**: $max(Hight2 - Low2; High2 - Close1; Close1 - Low2)$
3. Построение индикатора **DMI (Directional Movement Index)**:
	1. Определяем (чаще всего n=14, но бывает и от 7 до 30 дней):
		- $+DI = EMA(\frac{+DM}{ATR}, n)$
		- $-DI = EMA(\frac{-DM}{ATR}, n)$
	2. Строим +DI (синий) и -DI (оранжевый)
	3. Сигналы:
		- Когда +DI пересекает -DI снизу вверх - сигнал на покупку
		- Когда +DI пересекает -DI сверху вниз - сигнал на продажу
4. Рассчитываем **ADX** (от 0 до 100) - доля направленного движения во всём движении за период.
$$ADX = EMA(\frac{|(+DI)-(-DI)|}{|(+DI)+(-DI)|},n)$$
Определение ATR:
![[3_ATR.png]]

**Сигналы:** применяется совместно с DMI и оставляем те сигналы DMI, которые были на трендовом рынке.

**Недостатки ADX:**
- Срабатываем медленно из-за двойного сглаживания
- Ненадёжен при высокой волатильности
- Ненадёжен при резком переломе тренда

# Индикаторы связанные с объемом торгов

В общем случае, для индикаторов связанных с объемом мы смотрим на дивергенции и конвергенции, т.е. расхождение/схождение цены и графика индикатора.
## OBV

**TradingView:**
- В поиске: *Балансовый объем*
- На графике: *OBV*

OBV (on balance volume) - индикатор баланса объема.
OBV растет на величину объема торгов, если цены выросли, падает на величину объема торгов, если цены упали. Но сила изменения цены не влияет на динамику OBV.
$$OBV_t = OBV_{t-1}+\frac{Close_t-Close_{t-1}}{|Close_t-Close_{t-1}|}\times Volume_t$$
- Если **разность цен закрытия > 0**, то оборот текущего периода прибавляется к накопленному обороту
- Если **разность цен закрытия < 0**, то оборот текущего периода вычитается из накопленного оборота

На примере ниже на графике цены два пика показывают направление вверх, при этом эти аналогичные пики на графике индикатора показывают направление вниз, значит мы наблюдаем **дивергенцию** и OBV не подтверждает рост цен:

![[3_Дивергенция_для_OBV.png]]

## PVT

**TradingView:**
- В поиске: *Тренд цены и объёма*
- На графике: *PVT*

PVT (volume price trend) - тренд цены-объёма.
При расчете PVT используется как объем торгов, так и доходность за рассматриваемый таймфрейм.
$$PVT_t = PVT_{t-1} + Volume \times \frac{P_t - P_{t-1}}{P_{t-1}}$$

![[3_Дивергенция_для_PVT.png]]

## VA (A/D)

**TradingView:**
- В поиске: *Накопление/Распределение*
- На графике: *Accum/Dist*

**Основные названия:**
- VA (volume accumulation) - индикатор накопления объёма
- A/D (accumulation distribution) - индикатор накопления распределения

$$VA_t=\frac{(Close-Low) - (High-Close)}{High-Low} \times V + VA_{t-1}$$
Чем больше объем, тем больший вклад изменение цены вносит в изменение индикатора

![[3_Дивергенция_для_AD.png]]